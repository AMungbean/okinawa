<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†²ç»³æ—…æ¸¸è®°å½• - æˆ‘çš„ç‰çƒä¹‹æ—…</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* ========== å…¨å±€é‡ç½®æ ·å¼ ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* å¯¼å…¥å¤å¤é£æ ¼çš„å­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Ma+Shan+Zheng&display=swap');

        /* ========== é¡µé¢ä¸»ä½“æ ·å¼ ========== */
        /* å¤å¤æŸ”å’Œçš„èƒŒæ™¯è‰²å’Œæ¸å˜æ•ˆæœ */
        body {
            font-family: 'Noto Serif SC', 'PingFang SC', 'Microsoft YaHei', serif;
            background: #f5f1e8;
            /* æŸ”å’Œçš„å¾„å‘æ¸å˜ï¼Œè¥é€ æ¸©æš–å¤å¤æ°›å›´ */
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 182, 193, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(173, 216, 230, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 218, 185, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #f5f1e8 0%, #e8e0d3 50%, #f0ebe0 100%);
            min-height: 100vh;
            padding: 20px;
            color: #4a4a4a; /* æ›´æŸ”å’Œçš„æ–‡å­—é¢œè‰² */
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 20 Q60 30 50 40 Q40 30 50 20' fill='none' stroke='%23d4a574' stroke-width='0.5' opacity='0.3'/%3E%3C/svg%3E"),
                url("data:image/svg+xml,%3Csvg width='80' height='80' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='40' cy='40' r='15' fill='none' stroke='%23c8a882' stroke-width='0.3' opacity='0.2'/%3E%3C/svg%3E");
            background-size: 200px 200px, 150px 150px;
            background-position: 0 0, 100px 100px;
            pointer-events: none;
            z-index: 0;
        }

        /* å†²ç»³é£æ ¼è£…é¥°å…ƒç´  */
        .okinawa-decoration {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            opacity: 0.12;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.08));
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(var(--rotate, 0deg));
            }
            50% {
                transform: translateY(-10px) rotate(var(--rotate, 0deg));
            }
        }

        .decoration-palm {
            font-size: 70px;
            --rotate: -15deg;
        }

        .decoration-shisa {
            font-size: 55px;
            --rotate: 10deg;
        }

        .decoration-hibiscus {
            font-size: 45px;
            --rotate: 20deg;
        }

        .decoration-fish {
            font-size: 40px;
            --rotate: -10deg;
        }

        .decoration-fruit {
            font-size: 35px;
            --rotate: 15deg;
        }

        .decoration-cloud {
            font-size: 50px;
            --rotate: -5deg;
        }

        @media (max-width: 768px) {
            .okinawa-decoration {
                font-size: 0.6em !important;
                opacity: 0.08;
            }
        }

        /* ========== ä¸»å®¹å™¨æ ·å¼ ========== */
        /* å¤å¤æŸ”å’Œçš„å¡ç‰‡å®¹å™¨ï¼Œä½¿ç”¨åœ†è§’å’ŒæŸ”å’Œé˜´å½± */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fffef9;
            border-radius: 16px; /* åœ†è§’æ›¿ä»£å°–é”è¾¹è§’ */
            /* æŸ”å’Œçš„é˜´å½±æ•ˆæœï¼Œå‡å°‘æ”»å‡»æ€§ */
            box-shadow: 
                0 2px 8px rgba(212, 165, 116, 0.15),
                0 8px 32px rgba(0, 0, 0, 0.06);
            padding: 48px 40px;
            position: relative;
            overflow: visible;
            z-index: 1;
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡†æ›¿ä»£è™šçº¿ */
            border: 1px solid rgba(212, 165, 116, 0.25);
        }

        .container::before {
            content: 'ğŸŒº';
            position: absolute;
            top: -15px;
            left: 30px;
            font-size: 30px;
            background: #fffef9;
            padding: 0 10px;
            z-index: 2;
            transform: rotate(-15deg);
        }

        .container::after {
            content: 'ğŸï¸';
            position: absolute;
            top: -15px;
            right: 30px;
            font-size: 30px;
            background: #fffef9;
            padding: 0 10px;
            z-index: 2;
            transform: rotate(15deg);
        }

        /* å®¹å™¨å‘¨å›´çš„è£…é¥°å…ƒç´  */
        .container-decoration {
            position: absolute;
            pointer-events: none;
            z-index: 0;
            opacity: 0.25;
            font-size: 36px;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.1));
            animation: float 4s ease-in-out infinite;
        }

        .decoration-top-left {
            top: -30px;
            left: -20px;
            transform: rotate(-20deg);
            animation-delay: 0s;
        }

        .decoration-top-right {
            top: -30px;
            right: -20px;
            transform: rotate(20deg);
            animation-delay: 1s;
        }

        .decoration-bottom-left {
            bottom: -30px;
            left: -20px;
            transform: rotate(20deg);
            animation-delay: 2s;
        }

        .decoration-bottom-right {
            bottom: -30px;
            right: -20px;
            transform: rotate(-20deg);
            animation-delay: 3s;
        }

        /* ========== æ ‡é¢˜æ ·å¼ ========== */
        /* æŸ”å’Œçš„æ ‡é¢˜æ ·å¼ï¼Œå‡å°‘å¼ºçƒˆçš„æ–‡å­—é˜´å½± */
        h1 {
            text-align: center;
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„æ£•è‰² */
            margin-bottom: 12px;
            font-size: 2.6em;
            font-weight: 600; /* ç¨å¾®å‡è½»å­—é‡ */
            letter-spacing: 0.05em;
            line-height: 1.4;
            /* æŸ”å’Œçš„æ–‡å­—é˜´å½± */
            text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.2);
            position: relative;
            display: inline-block;
            width: 100%;
            padding: 0 20px;
        }

        h1::before,
        h1::after {
            content: 'âœ¿';
            color: #d4a574;
            font-size: 0.6em;
            margin: 0 10px;
            opacity: 0.6;
        }

        .subtitle {
            text-align: center;
            color: #8b6f47;
            margin-bottom: 32px;
            font-size: 1.1em;
            font-weight: 400;
            letter-spacing: 0.08em;
            font-style: italic;
            position: relative;
        }

        .subtitle::before {
            content: 'ã€Œ';
            color: #d4a574;
            font-size: 1.2em;
            margin-right: 8px;
        }

        .subtitle::after {
            content: 'ã€';
            color: #d4a574;
            font-size: 1.2em;
            margin-left: 8px;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        /* ========== ç»Ÿè®¡å¡ç‰‡æ ·å¼ ========== */
        /* æŸ”å’Œçš„ç»Ÿè®¡å¡ç‰‡ï¼Œä½¿ç”¨åœ†è§’å’ŒæŸ”å’Œé˜´å½± */
        .stat-card {
            background: #fffef9;
            padding: 28px 24px;
            border-radius: 12px; /* åœ†è§’ */
            text-align: center;
            /* æŸ”å’Œçš„é˜´å½±æ•ˆæœ */
            box-shadow: 
                0 2px 6px rgba(212, 165, 116, 0.12),
                0 4px 12px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.2);
            position: relative;
            overflow: visible;
            /* å¾®å¦™çš„èƒŒæ™¯çº¹ç† */
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(212, 165, 116, 0.02) 10px, rgba(212, 165, 116, 0.02) 20px);
        }

        .stat-card::before {
            content: 'ğŸŒŠ';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            background: #fffef9;
            padding: 0 8px;
            z-index: 1;
        }

        /* æ‚¬åœæ—¶çš„æŸ”å’Œæ•ˆæœ */
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 12px rgba(212, 165, 116, 0.18),
                0 8px 20px rgba(0, 0, 0, 0.06);
        }

        /* ç»Ÿè®¡æ•°å­—æ ·å¼ */
        .stat-number {
            font-size: 2.8em;
            font-weight: 600; /* å‡è½»å­—é‡ */
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            margin-bottom: 8px;
            line-height: 1;
            letter-spacing: 0.02em;
            text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.15);
        }

        .stat-label {
            font-size: 0.9em;
            color: #8b6f47;
            font-weight: 500;
            letter-spacing: 0.05em;
        }

        /* ========== åœ°å›¾å®¹å™¨æ ·å¼ ========== */
        /* æŸ”å’Œçš„åœ°å›¾å®¹å™¨ï¼Œä½¿ç”¨åœ†è§’ */
        .map-container {
            position: relative;
            background: transparent;
            border-radius: 12px; /* åœ†è§’ */
            padding: 0;
            margin: 0 auto 32px;
            border: none;
            box-shadow: none;
            overflow: hidden;
            /* ç«–å‘æ¯”ä¾‹ï¼Œæ›´è´´è¿‘ç‰çƒå¼§èµ°å‘ */
            max-width: 720px;
            width: 100%;
            aspect-ratio: 3 / 4;
            min-height: 600px;
            transition: all 0.3s ease;
        }

        .map-container::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(212, 165, 116, 0.1) 2px, rgba(212, 165, 116, 0.1) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(212, 165, 116, 0.1) 2px, rgba(212, 165, 116, 0.1) 4px);
            z-index: -1;
            pointer-events: none;
        }

        /* åœ°å›¾æœ¬èº« */
        #map {
            width: 100%;
            height: 100%;
            border-radius: 12px; /* åœ†è§’ */
            z-index: 1;
            border: none;
            box-shadow: none;
        }

        .region-marker {
            cursor: pointer;
        }

        .airport-marker {
            cursor: pointer;
        }

        .custom-popup {
            text-align: center;
            font-weight: bold;
            color: #8b4513;
            font-family: 'Noto Serif SC', serif;
        }

        /* ========== Leaflet å¼¹çª—æ ·å¼ ========== */
        /* æŸ”å’Œçš„å¼¹çª—æ ·å¼ */
        .leaflet-popup-content-wrapper {
            background: #fffef9;
            border-radius: 12px; /* åœ†è§’ */
            border: 1px solid rgba(212, 165, 116, 0.25); /* æŸ”å’Œè¾¹æ¡† */
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 2px 8px rgba(212, 165, 116, 0.15),
                0 4px 16px rgba(0, 0, 0, 0.06);
        }

        .leaflet-popup-content {
            margin: 16px;
            font-size: 14px;
            font-weight: 500;
            color: #8b4513;
            font-family: 'Noto Serif SC', serif;
        }

        /* å¼¹çª—å°ä¸‰è§’ */
        .leaflet-popup-tip {
            background: #fffef9;
            border: 1px solid rgba(212, 165, 116, 0.25);
        }

        /* Leaflet åº•å›¾ä¸ç“¦ç‰‡çš„é»˜è®¤èƒŒæ™¯ï¼Œé¿å…é«˜å€ç¼©æ”¾æˆ–åŠ è½½ä¸­å‡ºç°ç°è‰²å— */
        .leaflet-container {
            background: #e8f4f8;
        }

        .leaflet-tile {
            background-color: #a7d7ff !important;
        }

        /* ========== å²›å±¿åç§°æ ‡ç­¾æ ·å¼ï¼ˆæ‚¬åœæ—¶æ˜¾ç¤ºï¼‰ ========== */
        /* æŸ”å’Œçš„æ ‡ç­¾æ ·å¼ */
        .island-label {
            background: #fffef9 !important;
            border: 1px solid rgba(212, 165, 116, 0.3) !important;
            border-radius: 8px !important; /* åœ†è§’ */
            padding: 6px 10px !important;
            font-size: 11px !important;
            font-weight: 500 !important; /* å‡è½»å­—é‡ */
            color: #7a5a3a !important; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 1px 3px rgba(212, 165, 116, 0.15) !important;
            white-space: nowrap !important;
            font-family: 'Noto Serif SC', serif !important;
        }

        /* ä¸»ä½“å·¦å³å¸ƒå±€ */
        .main-layout {
            display: flex;
            gap: 32px;
            align-items: flex-start;
            margin-top: 20px;
        }

        .map-column {
            flex: 1.1;
            display: flex;
            justify-content: center;
        }

        /* ========== ä¾§è¾¹æ é¢æ¿æ ·å¼ ========== */
        /* æŸ”å’Œçš„ä¾§è¾¹æ ï¼Œä½¿ç”¨åœ†è§’å’ŒæŸ”å’Œé˜´å½± */
        .side-panel {
            flex: 1;
            max-width: 420px;
            background: #fffef9;
            border-radius: 12px; /* åœ†è§’ */
            padding: 32px 28px;
            /* æŸ”å’Œçš„é˜´å½±æ•ˆæœ */
            box-shadow: 
                0 2px 8px rgba(212, 165, 116, 0.15),
                0 4px 16px rgba(0, 0, 0, 0.06);
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.25);
            position: relative;
            /* å¾®å¦™çš„èƒŒæ™¯çº¹ç† */
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(212, 165, 116, 0.02) 10px, rgba(212, 165, 116, 0.02) 20px);
        }

        .side-panel::before {
            content: 'ğŸ—ºï¸';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 28px;
            background: #fffef9;
            padding: 0 8px;
            z-index: 1;
            transform: rotate(-10deg);
        }

        /* ä¾§è¾¹æ æ ‡é¢˜ */
        .side-title {
            font-size: 1.4em;
            font-weight: 600; /* å‡è½»å­—é‡ */
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            margin-bottom: 12px;
            letter-spacing: 0.05em;
            text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.15);
        }

        .side-subtitle {
            font-size: 0.9em;
            color: #8b6f47;
            margin-bottom: 28px;
            font-weight: 400;
            font-style: italic;
            line-height: 1.6;
        }

        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        /* ========== æŒ‰é’®æ ·å¼ ========== */
        /* æŸ”å’Œçš„æŒ‰é’®æ ·å¼ï¼Œä½¿ç”¨åœ†è§’å’ŒæŸ”å’Œé˜´å½± */
        .btn {
            padding: 14px 28px;
            border: 1px solid rgba(139, 69, 19, 0.3); /* æ›´æŸ”å’Œçš„è¾¹æ¡† */
            border-radius: 8px; /* åœ†è§’ */
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500; /* å‡è½»å­—é‡ */
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 2px 4px rgba(212, 165, 116, 0.12),
                0 1px 2px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: visible;
            letter-spacing: 0.05em;
            font-family: 'Noto Serif SC', serif;
        }

        /* ä¸»è¦æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background: #fffef9;
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            border-color: rgba(139, 69, 19, 0.3);
        }

        /* æŒ‰é’®æ‚¬åœæ•ˆæœ - æŸ”å’Œçš„ä¸Šæµ® */
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 8px rgba(212, 165, 116, 0.18),
                0 2px 4px rgba(0, 0, 0, 0.06);
            background: #fef9f0;
        }

        /* æ¬¡è¦æŒ‰é’®æ ·å¼ */
        .btn-secondary {
            background: #fffef9;
            color: #8b6f47;
            border-color: rgba(212, 165, 116, 0.3);
        }

        /* æ¬¡è¦æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 8px rgba(212, 165, 116, 0.18),
                0 2px 4px rgba(0, 0, 0, 0.06);
            background: #fef9f0;
        }

        /* éšæœºæŒ‰é’®æ ·å¼ */
        .btn-random {
            background: #fffef9;
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            border-color: rgba(212, 165, 116, 0.3);
        }

        /* éšæœºæŒ‰é’®æ‚¬åœæ•ˆæœ */
        .btn-random:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 8px rgba(212, 165, 116, 0.18),
                0 2px 4px rgba(0, 0, 0, 0.06);
            background: #fef9f0;
        }

        .region-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 16px;
            max-height: 420px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .group-title {
            margin-top: 16px;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 1em;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            font-size: 0.85em;
        }

        /* ========== åŒºåŸŸåˆ—è¡¨é¡¹æ ·å¼ ========== */
        /* æŸ”å’Œçš„åˆ—è¡¨é¡¹ï¼Œä½¿ç”¨åœ†è§’ */
        .region-item {
            background: #fffef9;
            padding: 16px 20px;
            border-radius: 8px; /* åœ†è§’ */
            cursor: pointer;
            transition: all 0.3s ease;
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 0 1px 3px rgba(212, 165, 116, 0.08);
            position: relative;
        }

        .region-item::before {
            content: 'â—‹';
            position: absolute;
            left: 8px;
            color: rgba(212, 165, 116, 0.3);
            font-size: 0.8em;
        }

        /* åˆ—è¡¨é¡¹æ‚¬åœæ•ˆæœ - æŸ”å’Œçš„ç§»åŠ¨ */
        .region-item:hover {
            background: #fef9f0;
            border-color: rgba(212, 165, 116, 0.35);
            transform: translateX(3px);
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 2px 6px rgba(212, 165, 116, 0.12),
                0 1px 2px rgba(0, 0, 0, 0.04);
        }

        /* å·²è®¿é—®çš„åˆ—è¡¨é¡¹æ ·å¼ */
        .region-item.visited {
            background: #f5efe5;
            border-color: rgba(139, 69, 19, 0.3);
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 1px 3px rgba(139, 69, 19, 0.15),
                inset 0 0 0 1px rgba(212, 165, 116, 0.15);
        }

        .region-item.visited::before {
            content: 'âœ“';
            color: #8b4513;
            font-weight: bold;
        }

        /* å¤é€‰æ¡†æ ·å¼ */
        .region-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            border-radius: 4px; /* åœ†è§’ */
        }

        /* ========== éšæœºç»“æœæ ·å¼ ========== */
        /* æŸ”å’Œçš„éšæœºç»“æœå¡ç‰‡ */
        .random-result {
            margin-top: 24px;
            padding: 24px 20px;
            background: #fffef9;
            border-radius: 12px; /* åœ†è§’ */
            text-align: center;
            display: none;
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.25);
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 2px 8px rgba(212, 165, 116, 0.15),
                0 4px 16px rgba(0, 0, 0, 0.06);
            position: relative;
        }

        .random-result::before {
            content: 'ğŸ²';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            background: #fffef9;
            padding: 0 8px;
            z-index: 1;
        }

        .random-result.show {
            display: block;
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* éšæœºç»“æœæ ‡é¢˜ */
        .random-result h3 {
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            margin-bottom: 12px;
            font-size: 1.75em;
            font-weight: 600; /* å‡è½»å­—é‡ */
            text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.15);
        }

        .random-result p {
            color: #8b6f47;
            font-size: 1.3em;
            font-weight: 600;
        }

        /* ========== åˆ†äº«åŒºåŸŸæ ·å¼ ========== */
        /* æŸ”å’Œçš„åˆ†äº«åŒºåŸŸ */
        .share-section {
            text-align: center;
            margin-top: 32px;
            padding: 28px 24px;
            background: #fffef9;
            border-radius: 12px; /* åœ†è§’ */
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.25);
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 2px 8px rgba(212, 165, 116, 0.15),
                0 4px 16px rgba(0, 0, 0, 0.06);
            position: relative;
            /* å¾®å¦™çš„èƒŒæ™¯çº¹ç† */
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(212, 165, 116, 0.02) 10px, rgba(212, 165, 116, 0.02) 20px);
        }

        .share-section::before {
            content: 'ğŸ“¤';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            background: #fffef9;
            padding: 0 8px;
            z-index: 1;
        }

        /* ========== ç»Ÿè®¡ç®¡ç†åŒºåŸŸæ ·å¼ ========== */
        /* æŸ”å’Œçš„ç»Ÿè®¡ç®¡ç†åŒºåŸŸ */
        .stats-admin {
            margin-top: 32px;
            padding: 28px 24px;
            background: #fffef9;
            border-radius: 12px; /* åœ†è§’ */
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.25);
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 2px 8px rgba(212, 165, 116, 0.15),
                0 4px 16px rgba(0, 0, 0, 0.06);
            position: relative;
            /* å¾®å¦™çš„èƒŒæ™¯çº¹ç† */
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(212, 165, 116, 0.02) 10px, rgba(212, 165, 116, 0.02) 20px);
        }

        .stats-admin::before {
            content: 'ğŸ“Š';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            background: #fffef9;
            padding: 0 8px;
            z-index: 1;
        }

        /* ç»Ÿè®¡ç®¡ç†æ ‡é¢˜ */
        .stats-admin h3 {
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            margin-bottom: 24px;
            text-align: center;
            font-size: 1.5em;
            font-weight: 600; /* å‡è½»å­—é‡ */
            letter-spacing: 0.05em;
            text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.15);
        }

        .stats-admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        /* ç®¡ç†ç»Ÿè®¡é¡¹æ ·å¼ */
        .admin-stat-item {
            background: #fffef9;
            padding: 20px;
            border-radius: 8px; /* åœ†è§’ */
            text-align: center;
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 1px 3px rgba(212, 165, 116, 0.12),
                0 2px 6px rgba(0, 0, 0, 0.04);
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.2);
            transition: all 0.3s ease;
        }

        /* ç®¡ç†ç»Ÿè®¡é¡¹æ‚¬åœæ•ˆæœ */
        .admin-stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 3px 8px rgba(212, 165, 116, 0.18),
                0 4px 12px rgba(0, 0, 0, 0.06);
        }

        /* ç®¡ç†ç»Ÿè®¡æ•°å­— */
        .admin-stat-number {
            font-size: 2.2em;
            font-weight: 600; /* å‡è½»å­—é‡ */
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            margin-bottom: 8px;
            line-height: 1;
            text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.15);
        }

        .admin-stat-label {
            font-size: 0.85em;
            color: #8b6f47;
            font-weight: 500;
            letter-spacing: 0.05em;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-admin {
            padding: 10px 20px;
            font-size: 0.9em;
        }

        /* ========== æ¸¸æˆåŒ–å¼¹çª—æ ·å¼ ========== */
        /* æŸ”å’Œçš„åº†ç¥å¼¹çª—é®ç½©å±‚ */
        .celebration-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4); /* æ›´æŸ”å’Œçš„èƒŒæ™¯ */
            backdrop-filter: blur(8px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .celebration-modal.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* åº†ç¥å¼¹çª—å†…å®¹ */
        .celebration-content {
            background: #fffef9;
            border-radius: 16px; /* åœ†è§’ */
            padding: 40px 32px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 4px 16px rgba(212, 165, 116, 0.2),
                0 12px 40px rgba(0, 0, 0, 0.15);
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.3);
            position: relative;
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            /* å¾®å¦™çš„èƒŒæ™¯çº¹ç† */
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(212, 165, 116, 0.02) 10px, rgba(212, 165, 116, 0.02) 20px);
        }

        .celebration-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.05);
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .celebration-close:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: rotate(90deg);
        }

        .celebration-icon {
            font-size: 80px;
            margin-bottom: 24px;
            animation: bounce 1s ease infinite;
            display: block;
        }

        /* åº†ç¥å¼¹çª—æ ‡é¢˜ */
        .celebration-title {
            font-size: 2em;
            font-weight: 600; /* å‡è½»å­—é‡ */
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            margin-bottom: 16px;
            line-height: 1.3;
            text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.2);
            font-family: 'Noto Serif SC', serif;
        }

        .celebration-text {
            font-size: 1.1em;
            color: #8b6f47;
            margin-bottom: 32px;
            line-height: 1.6;
            font-weight: 500;
            font-family: 'Noto Serif SC', serif;
        }

        .celebration-pattern {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .pattern-item {
            font-size: 32px;
            animation: rotate 3s linear infinite;
        }

        .pattern-item:nth-child(2) {
            animation-delay: 0.5s;
            animation-direction: reverse;
        }

        .pattern-item:nth-child(3) {
            animation-delay: 1s;
        }

        /* åº†ç¥å¼¹çª—æŒ‰é’® */
        .celebration-button {
            margin-top: 24px;
            padding: 14px 32px;
            background: #fffef9;
            color: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
            border: 1px solid rgba(139, 69, 19, 0.3);
            border-radius: 8px; /* åœ†è§’ */
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 
                0 2px 4px rgba(212, 165, 116, 0.12),
                0 1px 2px rgba(0, 0, 0, 0.04);
            font-family: 'Noto Serif SC', serif;
        }

        /* åº†ç¥å¼¹çª—æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .celebration-button:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 8px rgba(212, 165, 116, 0.18),
                0 2px 4px rgba(0, 0, 0, 0.06);
            background: #fef9f0;
        }

        .share-btn {
            margin: 10px;
        }

        /* ========== å›¾ä¾‹æ ·å¼ ========== */
        /* æŸ”å’Œçš„åœ°å›¾å›¾ä¾‹ */
        .legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 24px;
            flex-wrap: wrap;
            padding: 16px 20px;
            background: #fffef9;
            border-radius: 8px; /* åœ†è§’ */
            /* æŸ”å’Œçš„å®çº¿è¾¹æ¡† */
            border: 1px solid rgba(212, 165, 116, 0.2);
            /* æŸ”å’Œçš„é˜´å½± */
            box-shadow: 0 1px 3px rgba(212, 165, 116, 0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            color: #8b6f47;
            font-weight: 500;
            font-family: 'Noto Serif SC', serif;
        }

        /* å›¾ä¾‹é¢œè‰²å— */
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px; /* åœ†è§’ */
            border: 1px solid rgba(212, 165, 116, 0.3);
            box-shadow: 0 1px 2px rgba(212, 165, 116, 0.15);
        }

        /* å·²è®¿é—®é¢œè‰² */
        .legend-color.visited {
            background: #7a5a3a; /* æ›´æŸ”å’Œçš„é¢œè‰² */
        }

        .legend-color.unvisited {
            background: #e8e0d3;
        }

        .legend-color.airport {
            background: #d4a574;
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .container {
                padding: 20px 16px;
            }

            .container::before,
            .container::after {
                font-size: 24px;
                top: -12px;
            }

            h1 {
                font-size: 1.8em;
                padding: 0 10px;
            }

            .subtitle {
                font-size: 0.95em;
            }
            
            .stats-bar {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .stat-card {
                padding: 20px 16px;
            }

            .stat-card::before {
                font-size: 20px;
                top: -10px;
            }

            .stat-number {
                font-size: 2.2em;
            }

            .main-layout {
                flex-direction: column;
                gap: 20px;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                padding: 14px 20px;
            }

            .map-container {
                max-width: 100%;
                aspect-ratio: 3 / 4;
                min-height: 400px;
            }

            .side-panel {
                max-width: 100%;
                padding: 20px 16px;
            }

            .side-panel::before {
                font-size: 24px;
                top: -12px;
            }

            .share-section,
            .stats-admin {
                padding: 20px 16px;
            }

            .share-section::before,
            .stats-admin::before {
                font-size: 24px;
                top: -12px;
            }

            .stats-admin-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .admin-stat-item {
                padding: 16px 12px;
            }

            .admin-stat-number {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯è£…é¥°å…ƒç´  - å†²ç»³é£æ ¼æ‹¼è´´è‰ºæœ¯ -->
    <!-- é¡¶éƒ¨è£…é¥° -->
    <div class="okinawa-decoration decoration-palm" style="top: 3%; left: 1%;">ğŸŒ´</div>
    <div class="okinawa-decoration decoration-palm" style="top: 3%; right: 1%; transform: rotate(15deg) scaleX(-1);">ğŸŒ´</div>
    <div class="okinawa-decoration decoration-cloud" style="top: 8%; left: 8%;">â˜ï¸</div>
    <div class="okinawa-decoration decoration-cloud" style="top: 10%; right: 8%;">â˜ï¸</div>
    
    <!-- ä¸­éƒ¨å·¦ä¾§è£…é¥° -->
    <div class="okinawa-decoration decoration-shisa" style="top: 20%; left: 2%;">ğŸ¦</div>
    <div class="okinawa-decoration decoration-hibiscus" style="top: 30%; left: 1%;">ğŸŒº</div>
    <div class="okinawa-decoration decoration-fruit" style="top: 40%; left: 3%;">ğŸ</div>
    <div class="okinawa-decoration decoration-fish" style="top: 50%; left: 2%;">ğŸ </div>
    
    <!-- ä¸­éƒ¨å³ä¾§è£…é¥° -->
    <div class="okinawa-decoration decoration-shisa" style="top: 20%; right: 2%;">ğŸ¦</div>
    <div class="okinawa-decoration decoration-hibiscus" style="top: 30%; right: 1%;">ğŸŒº</div>
    <div class="okinawa-decoration decoration-fruit" style="top: 40%; right: 3%;">ğŸ¥­</div>
    <div class="okinawa-decoration decoration-fish" style="top: 50%; right: 2%;">ğŸŸ</div>
    
    <!-- åº•éƒ¨è£…é¥° -->
    <div class="okinawa-decoration decoration-fish" style="bottom: 25%; left: 1%;">ğŸ </div>
    <div class="okinawa-decoration decoration-fruit" style="bottom: 15%; left: 3%;">ğŸ</div>
    <div class="okinawa-decoration" style="bottom: 8%; left: 12%; font-size: 50px; transform: rotate(-10deg);">ğŸŒŠ</div>
    <div class="okinawa-decoration decoration-fish" style="bottom: 25%; right: 1%;">ğŸŸ</div>
    <div class="okinawa-decoration decoration-fruit" style="bottom: 15%; right: 3%;">ğŸ¥­</div>
    <div class="okinawa-decoration" style="bottom: 8%; right: 12%; font-size: 45px; transform: rotate(10deg);">ğŸ‹</div>
    <div class="okinawa-decoration" style="bottom: 3%; left: 50%; font-size: 40px; transform: translateX(-50%);">ğŸŒº</div>

    <div class="container">
        <!-- å®¹å™¨è£…é¥°å…ƒç´  - å†²ç»³ç‰¹è‰² -->
        <div class="container-decoration decoration-top-left">ğŸŒº</div>
        <div class="container-decoration decoration-top-right">ğŸ¦</div>
        <div class="container-decoration decoration-bottom-left">ğŸ </div>
        <div class="container-decoration decoration-bottom-right">ğŸŒ´</div>
        <div class="container-decoration" style="top: 50%; left: -25px; transform: translateY(-50%) rotate(-90deg);">ğŸŒŠ</div>
        <div class="container-decoration" style="top: 50%; right: -25px; transform: translateY(-50%) rotate(90deg);">ğŸ</div>
        
        <h1>ğŸŒº æˆ‘çš„å†²ç»³æ—…æ¸¸è®°å½• ğŸŒº</h1>
        <p class="subtitle">è®°å½•ä½ åœ¨ç‰çƒè¯¸å²›çš„æ¯ä¸€æ¬¡ç¾å¥½æ—…ç¨‹</p>

        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-number" id="visitedCount">0</div>
                <div class="stat-label">å·²è®¿é—®åœ°ç‚¹</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCount">32</div>
                <div class="stat-label">æ€»åœ°ç‚¹æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="percentage">0%</div>
                <div class="stat-label">æ¢ç´¢è¿›åº¦</div>
            </div>
        </div>

        <div class="main-layout">
            <div class="map-column">
        <div class="map-container">
                    <div id="map"></div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color unvisited"></div>
                    <span>æœªè®¿é—®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color visited"></div>
                    <span>å·²è®¿é—®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color airport"></div>
                    <span>æœºåœº</span>
                </div>
                    </div>
                </div>
            </div>

            <div class="side-panel">
                <div class="side-title">é€‰æ‹©ä½ å»è¿‡çš„åœ°æ–¹</div>
                <div class="side-subtitle">æŒ‰ç…§åˆ—å²›åˆ†ç»„ï¼ˆå¥„ç¾ã€å†²ç»³æœ¬å²›ã€å®«å¤ã€å…«é‡å±±ç­‰ï¼‰ï¼Œå‹¾é€‰ä½ åˆ°è®¿è¿‡çš„å²›å±¿</div>

                <div class="controls">
                    <button class="btn btn-secondary" onclick="clearAll()">æ¸…é™¤æ‰€æœ‰è®°å½•</button>
                    <button class="btn btn-random" onclick="randomDestination()">ğŸ² éšæœºé€‰æ‹©ä¸‹æ¬¡ç›®çš„åœ°</button>
                </div>

                <div class="random-result" id="randomResult">
                    <h3>ğŸ¯ ä½ çš„ä¸‹ä¸€ä¸ªç›®çš„åœ°æ˜¯ï¼š</h3>
                    <p id="randomDestinationName"></p>
                </div>

                <!-- é™æ€åˆ—å²›åˆ†ç»„åˆ—è¡¨ï¼Œé¿å…è„šæœ¬å¼‚å¸¸å¯¼è‡´çœ‹ä¸åˆ°å‹¾é€‰é¡¹ -->
                <div class="region-list">
                    <!-- å¤§éš…ç¾¤å²› -->
                    <div class="group-title">å¤§éš…ç¾¤å²›</div>
                    <div class="region-item">
                        <span>å±‹ä¹…å²›</span>
                        <input type="checkbox" data-id="osumi-yakushima" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ç§å­å²›</span>
                        <input type="checkbox" data-id="osumi-tanegashima" onchange="toggleRegionFromCheckbox(this)">
                    </div>

                    <!-- åå™¶å–‡åˆ—å²› -->
                    <div class="group-title" style="margin-top:10px;">åå™¶å–‡åˆ—å²›</div>
                    <div class="region-item">
                        <span>ä¸­ä¹‹å²›ï¼ˆåå™¶å–‡ï¼‰</span>
                        <input type="checkbox" data-id="tokara-nakanoshima" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å£ä¹‹å²›</span>
                        <input type="checkbox" data-id="tokara-kuchinoshima" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å®å²›</span>
                        <input type="checkbox" data-id="tokara-takarajima" onchange="toggleRegionFromCheckbox(this)">
                    </div>

                    <!-- å¥„ç¾ç¾¤å²› -->
                    <div class="group-title" style="margin-top:10px;">å¥„ç¾ç¾¤å²›</div>
                    <div class="region-item">
                        <span>å¥„ç¾å¤§å²›</span>
                        <input type="checkbox" data-id="amami-oshima" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å–œç•Œå²›</span>
                        <input type="checkbox" data-id="amami-kikai" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å¾·ä¹‹å²›</span>
                        <input type="checkbox" data-id="amami-tokunoshima" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å†²æ°¸è‰¯éƒ¨å²›</span>
                        <input type="checkbox" data-id="amami-okinoerabu" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ä¸è®ºå²›</span>
                        <input type="checkbox" data-id="amami-yoron" onchange="toggleRegionFromCheckbox(this)">
                    </div>

                    <!-- å†²ç»³æœ¬å²›åŠå‘¨è¾¹ -->
                    <div class="group-title" style="margin-top:10px;">å†²ç»³æœ¬å²›åŠå‘¨è¾¹</div>
                    <div class="region-item">
                        <span>å†²ç»³æœ¬å²›</span>
                        <input type="checkbox" data-id="okinawa-main" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>åº†è‰¯é—´ç¾¤å²›</span>
                        <input type="checkbox" data-id="okinawa-kerama" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ä¹…ç±³å²›</span>
                        <input type="checkbox" data-id="okinawa-kume" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ä¼Šæ±Ÿå²›</span>
                        <input type="checkbox" data-id="okinawa-ie" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ä¹…é«˜å²›</span>
                        <input type="checkbox" data-id="okinawa-kudaka" onchange="toggleRegionFromCheckbox(this)">
                    </div>

                    <!-- å¤§ä¸œç¾¤å²› -->
                    <div class="group-title" style="margin-top:10px;">å¤§ä¸œç¾¤å²›</div>
                    <div class="region-item">
                        <span>åŒ—å¤§ä¸œå²›</span>
                        <input type="checkbox" data-id="daito-kitadaito" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å—å¤§ä¸œå²›</span>
                        <input type="checkbox" data-id="daito-minamidaito" onchange="toggleRegionFromCheckbox(this)">
                    </div>

                    <!-- å®«å¤ç¾¤å²› -->
                    <div class="group-title" style="margin-top:10px;">å®«å¤ç¾¤å²›</div>
                    <div class="region-item">
                        <span>å®«å¤å²›</span>
                        <input type="checkbox" data-id="miyako-main" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>æ± é—´å²›</span>
                        <input type="checkbox" data-id="miyako-ikei" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>æ¥é—´å²›</span>
                        <input type="checkbox" data-id="miyako-kurima" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ä¸‹åœ°å²›</span>
                        <input type="checkbox" data-id="miyako-shimoji" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å¤šè‰¯é—´å²›</span>
                        <input type="checkbox" data-id="miyako-tarama" onchange="toggleRegionFromCheckbox(this)">
                    </div>

                    <!-- å…«é‡å±±ç¾¤å²› -->
                    <div class="group-title" style="margin-top:10px;">å…«é‡å±±ç¾¤å²›</div>
                    <div class="region-item">
                        <span>çŸ³å£å²›</span>
                        <input type="checkbox" data-id="yaeyama-ishigaki" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>è¥¿è¡¨å²›</span>
                        <input type="checkbox" data-id="yaeyama-irihomote" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ç«¹å¯Œå²›</span>
                        <input type="checkbox" data-id="yaeyama-taketomi" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>å°æ»¨å²›</span>
                        <input type="checkbox" data-id="yaeyama-kohama" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>é»‘å²›</span>
                        <input type="checkbox" data-id="yaeyama-kuroshima" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>æ³¢ç…§é—´å²›</span>
                        <input type="checkbox" data-id="yaeyama-hateruma" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                    <div class="region-item">
                        <span>ä¸é‚£å›½å²›</span>
                        <input type="checkbox" data-id="yaeyama-yonaguni" onchange="toggleRegionFromCheckbox(this)">
                    </div>
                </div>
            </div>
        </div>

        <div class="share-section">
            <h3 style="color: #7a5a3a; margin-bottom: 20px; font-size: 1.5em; font-weight: 600; text-shadow: 1px 1px 2px rgba(212, 165, 116, 0.15);">åˆ†äº«ä½ çš„æ—…ç¨‹</h3>
            <button class="btn btn-primary share-btn" onclick="sharePage()">ğŸ“¤ åˆ†äº«é¡µé¢</button>
            <button class="btn btn-secondary share-btn" onclick="copyLink()">ğŸ”— å¤åˆ¶é“¾æ¥</button>
            <button class="btn btn-secondary share-btn" onclick="exportData()">ğŸ’¾ å¯¼å‡ºæ•°æ®</button>
            <button class="btn btn-secondary share-btn" onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
        </div>

        <div class="stats-admin">
            <h3>ğŸ“Š è®¿é—®ç»Ÿè®¡</h3>
            <div class="stats-admin-grid">
                <div class="admin-stat-item">
                    <div class="admin-stat-number" id="totalPV">0</div>
                    <div class="admin-stat-label">æ€»è®¿é—®é‡ (PV)</div>
                </div>
                <div class="admin-stat-item">
                    <div class="admin-stat-number" id="totalUV">0</div>
                    <div class="admin-stat-label">ç‹¬ç«‹è®¿å®¢ (UV)</div>
                </div>
                <div class="admin-stat-item">
                    <div class="admin-stat-number" id="todayPV">0</div>
                    <div class="admin-stat-label">ä»Šæ—¥è®¿é—® (PV)</div>
                </div>
                <div class="admin-stat-item">
                    <div class="admin-stat-number" id="todayUV">0</div>
                    <div class="admin-stat-label">ä»Šæ—¥è®¿å®¢ (UV)</div>
                </div>
            </div>
            <div class="admin-actions">
                <button class="btn btn-secondary btn-admin" onclick="exportStats()">ğŸ“Š å¯¼å‡ºç»Ÿè®¡æ•°æ®</button>
                <button class="btn btn-secondary btn-admin" onclick="clearStats()">ğŸ—‘ï¸ æ¸…ç©ºç»Ÿè®¡æ•°æ®</button>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆåŒ–å¼¹çª— -->
    <div id="celebrationModal" class="celebration-modal">
        <div class="celebration-content">
            <button class="celebration-close" onclick="closeCelebrationModal()">Ã—</button>
            <div class="celebration-icon" id="celebrationIcon">ğŸ‰</div>
            <h2 class="celebration-title" id="celebrationTitle">æ­å–œä½ å¼€å§‹äº†å†²ç»³ä¹‹æ—…</h2>
            <p class="celebration-text" id="celebrationText">å¼€å§‹ä½ çš„ç‰çƒåˆ—å²›æ¢ç´¢ä¹‹æ—…å§ï¼</p>
            <div class="celebration-pattern" id="celebrationPattern">
                <span class="pattern-item">ğŸŒº</span>
                <span class="pattern-item">ğŸï¸</span>
                <span class="pattern-item">ğŸŒŠ</span>
            </div>
            <button class="celebration-button" onclick="closeCelebrationModal()">ç»§ç»­æ¢ç´¢</button>
        </div>
    </div>

    <script>
        /* ========== æ•°æ®å®šä¹‰ ========== */
        // æ‰€æœ‰åŒºåŸŸæ•°æ®ï¼ˆç²¾ç®€ç‰ˆï¼šè¦†ç›–ä¸»è¦è§‚å…‰å²›å±¿ï¼ŒåŒ…å«é¢ç§¯å’ŒçœŸå®åœ°ç†åæ ‡ï¼Œå•ä½ï¼šå¹³æ–¹å…¬é‡Œï¼‰
        const regions = {
            // å¤§éš…ç¾¤å²›ï¼ˆä»£è¡¨ï¼šå±‹ä¹…å²›ï¼‰
            'osumi-yakushima': { name: 'å±‹ä¹…å²›', area: 504.88, group: 'osumi', lat: 30.3580, lng: 130.5280 },
            'osumi-kuchinoerabu': { name: 'å£æ°¸è‰¯éƒ¨å²›', area: 38.04, group: 'osumi', lat: 30.4710, lng: 130.2030 },
            'osumi-tanegashima': { name: 'ç§å­å²›', area: 444.99, group: 'osumi', lat: 30.5920, lng: 130.9880 },

            // åå™¶å–‡åˆ—å²›ï¼ˆé€‰å–å‡ ä¸ªä»£è¡¨æ€§æœ‰äººå²›ï¼‰
            'tokara-nakanoshima': { name: 'ä¸­ä¹‹å²›ï¼ˆåå™¶å–‡ï¼‰', area: 34.47, group: 'tokara', lat: 29.8470, lng: 129.8500 },
            'tokara-kuchinoshima': { name: 'å£ä¹‹å²›', area: 13.33, group: 'tokara', lat: 29.9650, lng: 129.9330 },
            'tokara-takarajima': { name: 'å®å²›', area: 7.14, group: 'tokara', lat: 29.1330, lng: 129.2160 },

            // å¥„ç¾ç¾¤å²›ï¼ˆä»£è¡¨æ€§å²›å±¿ï¼‰
            'amami-oshima': { name: 'å¥„ç¾å¤§å²›', area: 712.35, group: 'amami', lat: 28.3764, lng: 129.4942 },
            'amami-kikai': { name: 'å–œç•Œå²›', area: 56.93, group: 'amami', lat: 28.3214, lng: 129.9281 },
            'amami-tokunoshima': { name: 'å¾·ä¹‹å²›', area: 247.77, group: 'amami', lat: 27.8361, lng: 128.8811 },
            'amami-okinoerabu': { name: 'å†²æ°¸è‰¯éƒ¨å²›', area: 93.65, group: 'amami', lat: 27.4250, lng: 128.7008 },
            'amami-yoron': { name: 'ä¸è®ºå²›', area: 20.8, group: 'amami', lat: 27.0431, lng: 128.4014 },

            // å†²ç»³æœ¬å²›åŠå‘¨è¾¹
            'okinawa-main': { name: 'å†²ç»³æœ¬å²›', area: 1206.98, group: 'okinawa', lat: 26.2124, lng: 127.6809 },
            'okinawa-kerama': { name: 'åº†è‰¯é—´ç¾¤å²›', area: 35.97, group: 'okinawa', lat: 26.2000, lng: 127.3000 },
            'okinawa-kume': { name: 'ä¹…ç±³å²›', area: 59.11, group: 'okinawa', lat: 26.3636, lng: 126.7139 },
            'okinawa-ie': { name: 'ä¼Šæ±Ÿå²›', area: 22.77, group: 'okinawa', lat: 26.7167, lng: 127.7833 },
            'okinawa-kudaka': { name: 'ä¹…é«˜å²›', area: 1.38, group: 'okinawa', lat: 26.1500, lng: 127.8500 },
            
            // å¤§ä¸œç¾¤å²›
            'daito-kitadaito': { name: 'åŒ—å¤§ä¸œå²›', area: 11.94, group: 'daito', lat: 25.9447, lng: 131.3064 },
            'daito-minamidaito': { name: 'å—å¤§ä¸œå²›', area: 30.57, group: 'daito', lat: 25.8333, lng: 131.2333 },

            // å®«å¤ç¾¤å²›
            'miyako-main': { name: 'å®«å¤å²›', area: 158.87, group: 'miyako', lat: 24.7828, lng: 125.2950 },
            'miyako-ikei': { name: 'æ± é—´å²›', area: 2.83, group: 'miyako', lat: 24.9333, lng: 125.2333 },
            'miyako-kurima': { name: 'æ¥é—´å²›', area: 2.84, group: 'miyako', lat: 24.7167, lng: 125.2500 },
            'miyako-shimoji': { name: 'ä¸‹åœ°å²›', area: 9.54, group: 'miyako', lat: 24.8167, lng: 125.1500 },
            'miyako-tarama': { name: 'å¤šè‰¯é—´å²›', area: 19.75, group: 'miyako', lat: 24.6500, lng: 124.7000 },

            // å…«é‡å±±ç¾¤å²›
            'yaeyama-ishigaki': { name: 'çŸ³å£å²›', area: 222.65, group: 'yaeyama', lat: 24.3447, lng: 124.1869 },
            'yaeyama-irihomote': { name: 'è¥¿è¡¨å²›', area: 289.27, group: 'yaeyama', lat: 24.3667, lng: 123.7500 },
            'yaeyama-taketomi': { name: 'ç«¹å¯Œå²›', area: 5.42, group: 'yaeyama', lat: 24.3333, lng: 124.0833 },
            'yaeyama-kohama': { name: 'å°æ»¨å²›', area: 7.84, group: 'yaeyama', lat: 24.3447, lng: 124.1833 },
            'yaeyama-kuroshima': { name: 'é»‘å²›', area: 10.02, group: 'yaeyama', lat: 24.2333, lng: 123.9833 },
            'yaeyama-hateruma': { name: 'æ³¢ç…§é—´å²›', area: 12.77, group: 'yaeyama', lat: 24.0500, lng: 123.7833 },
            'yaeyama-yonaguni': { name: 'ä¸é‚£å›½å²›', area: 28.88, group: 'yaeyama', lat: 24.4667, lng: 123.0000 }
        };

        // åˆ—å²›åˆ†ç»„åç§°ï¼ˆç”¨äºå³ä¾§åˆ—è¡¨å±•ç¤ºå’Œåˆ†ç»„ç»Ÿè®¡ï¼‰
        const islandGroups = {
            osumi: 'å¤§éš…ç¾¤å²›',
            tokara: 'åå™¶å–‡åˆ—å²›',
            amami: 'å¥„ç¾ç¾¤å²›',
            okinawa: 'å†²ç»³æœ¬å²›åŠå‘¨è¾¹',
            daito: 'å¤§ä¸œç¾¤å²›',
            miyako: 'å®«å¤ç¾¤å²›',
            yaeyama: 'å…«é‡å±±ç¾¤å²›'
        };

        // æœºåœºæ•°æ®ï¼ˆçœŸå®åæ ‡ï¼Œç”¨äºåœ¨åœ°å›¾ä¸Šæ ‡è®°æœºåœºä½ç½®ï¼‰
        const airports = [
            { name: 'å±‹ä¹…å²›æœºåœº', lat: 30.3856, lng: 130.6589, id: 'osumi-yakushima' },
            { name: 'ç§å­å²›æœºåœº', lat: 30.6052, lng: 130.9902, id: 'osumi-tanegashima' },
            { name: 'å¥„ç¾æœºåœº', lat: 28.4306, lng: 129.7125, id: 'amami-oshima' },
            { name: 'å–œç•Œæœºåœº', lat: 28.3214, lng: 129.9281, id: 'amami-kikai' },
            { name: 'å¾·ä¹‹å²›æœºåœº', lat: 27.8361, lng: 128.8811, id: 'amami-tokunoshima' },
            { name: 'å†²æ°¸è‰¯éƒ¨æœºåœº', lat: 27.4250, lng: 128.7008, id: 'amami-okinoerabu' },
            { name: 'ä¸è®ºæœºåœº', lat: 27.0431, lng: 128.4014, id: 'amami-yoron' },
            { name: 'é‚£éœ¸æœºåœº', lat: 26.1958, lng: 127.6456, id: 'okinawa-main' },
            { name: 'ä¹…ç±³å²›æœºåœº', lat: 26.3636, lng: 126.7139, id: 'okinawa-kume' },
            { name: 'åŒ—å¤§ä¸œæœºåœº', lat: 25.9447, lng: 131.3064, id: 'daito-kitadaito' },
            { name: 'å—å¤§ä¸œæœºåœº', lat: 25.8333, lng: 131.2333, id: 'daito-minamidaito' },
            { name: 'å®«å¤æœºåœº', lat: 24.7828, lng: 125.2950, id: 'miyako-main' },
            { name: 'ä¸‹åœ°å²›æœºåœº', lat: 24.8267, lng: 125.1447, id: 'miyako-shimoji' },
            { name: 'çŸ³å£æœºåœº', lat: 24.3447, lng: 124.1869, id: 'yaeyama-ishigaki' },
            { name: 'ä¸é‚£å›½æœºåœº', lat: 24.4669, lng: 123.0000, id: 'yaeyama-yonaguni' }
        ];

        /* ========== å…¨å±€å˜é‡ ========== */
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å·²è®¿é—®çš„åœ°ç‚¹ï¼ˆå¦‚æœæœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„ï¼‰
        let visitedRegions = JSON.parse(localStorage.getItem('visitedRegions') || '[]');
        // Leafletåœ°å›¾å®ä¾‹
        let map;
        // å­˜å‚¨æ‰€æœ‰åŒºåŸŸæ ‡è®°çš„æ˜ å°„å¯¹è±¡ï¼ˆkeyä¸ºåŒºåŸŸIDï¼Œvalueä¸ºLeafletæ ‡è®°å¯¹è±¡ï¼‰
        let markers = {};
        // å­˜å‚¨æ‰€æœ‰æœºåœºæ ‡è®°çš„æ•°ç»„
        let airportMarkers = [];
        // å›¾æ ‡å˜é‡éœ€è¦æå‡ä¸ºå…¨å±€ï¼Œä¾› updateMap() ä½¿ç”¨
        // å·²è®¿é—®ã€æœªè®¿é—®å’Œæœºåœºçš„å›¾æ ‡
        let visitedIcon, unvisitedIcon, airportIcon;

        /* ========== è®¿é—®ç»Ÿè®¡åŠŸèƒ½ ========== */
        // è®°å½•é¡µé¢è®¿é—®ï¼ˆç”¨äºç»Ÿè®¡PVå’ŒUVï¼‰
        function recordVisit() {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            const now = Date.now();
            
            // è·å–æˆ–åˆå§‹åŒ–ç»Ÿè®¡æ•°æ®
            let stats = JSON.parse(localStorage.getItem('visitStats') || '{}');
            
            // æ€»PVï¼šæ¯æ¬¡è®¿é—®éƒ½+1
            stats.totalPV = (stats.totalPV || 0) + 1;
            
            // ä»Šæ—¥PV
            if (!stats.dailyStats) stats.dailyStats = {};
            if (!stats.dailyStats[today]) {
                stats.dailyStats[today] = { pv: 0, visitors: [] };
            }
            stats.dailyStats[today].pv += 1;
            
            // UVç»Ÿè®¡ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯æ–°è®¿å®¢ï¼ˆåŸºäºlocalStorageçš„visitorIdï¼‰
            let visitorId = localStorage.getItem('visitorId');
            if (!visitorId) {
                visitorId = 'visitor_' + now + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('visitorId', visitorId);
            }
            
            // æ€»UVï¼šæ£€æŸ¥è¿™ä¸ªvisitorIdæ˜¯å¦å·²ç»è®°å½•è¿‡
            if (!stats.uniqueVisitors) stats.uniqueVisitors = [];
            if (!stats.uniqueVisitors.includes(visitorId)) {
                stats.uniqueVisitors.push(visitorId);
            }
            
            // ä»Šæ—¥UVï¼šæ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²ç»è®¿é—®è¿‡
            if (!stats.dailyStats[today].visitors.includes(visitorId)) {
                stats.dailyStats[today].visitors.push(visitorId);
            }
            
            // ä¿å­˜ç»Ÿè®¡æ•°æ®
            localStorage.setItem('visitStats', JSON.stringify(stats));
            
            // æ›´æ–°æ˜¾ç¤º
            updateVisitStats();
        }
        
        // æ›´æ–°è®¿é—®ç»Ÿè®¡çš„æ˜¾ç¤ºï¼ˆä»æœ¬åœ°å­˜å‚¨è¯»å–ç»Ÿè®¡æ•°æ®å¹¶æ›´æ–°é¡µé¢æ˜¾ç¤ºï¼‰
        function updateVisitStats() {
            const stats = JSON.parse(localStorage.getItem('visitStats') || '{}');
            const today = new Date().toISOString().split('T')[0];
            
            // æ€»PVå’ŒUV
            document.getElementById('totalPV').textContent = stats.totalPV || 0;
            document.getElementById('totalUV').textContent = (stats.uniqueVisitors || []).length;
            
            // ä»Šæ—¥PVå’ŒUV
            const todayStats = stats.dailyStats && stats.dailyStats[today] ? stats.dailyStats[today] : { pv: 0, visitors: [] };
            document.getElementById('todayPV').textContent = todayStats.pv || 0;
            document.getElementById('todayUV').textContent = todayStats.visitors ? todayStats.visitors.length : 0;
        }
        
        // å¯¼å‡ºè®¿é—®ç»Ÿè®¡æ•°æ®ä¸ºJSONæ–‡ä»¶
        function exportStats() {
            const stats = JSON.parse(localStorage.getItem('visitStats') || '{}');
            const data = {
                ...stats,
                exportDate: new Date().toISOString(),
                summary: {
                    totalPV: stats.totalPV || 0,
                    totalUV: (stats.uniqueVisitors || []).length,
                    todayPV: stats.dailyStats && stats.dailyStats[new Date().toISOString().split('T')[0]] 
                        ? stats.dailyStats[new Date().toISOString().split('T')[0]].pv : 0,
                    todayUV: stats.dailyStats && stats.dailyStats[new Date().toISOString().split('T')[0]]
                        ? stats.dailyStats[new Date().toISOString().split('T')[0]].visitors.length : 0
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `è®¿é—®ç»Ÿè®¡_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // æ¸…ç©ºæ‰€æœ‰è®¿é—®ç»Ÿè®¡æ•°æ®ï¼ˆéœ€è¦ç”¨æˆ·ç¡®è®¤ï¼‰
        function clearStats() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®¿é—®ç»Ÿè®¡æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('visitStats');
                localStorage.removeItem('visitorId');
                updateVisitStats();
                alert('ç»Ÿè®¡æ•°æ®å·²æ¸…ç©ºï¼');
            }
        }

        /* ========== é¡µé¢åˆå§‹åŒ– ========== */
        // åˆå§‹åŒ–é¡µé¢ï¼ˆåœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ï¼‰
        function init() {
            recordVisit(); // è®°å½•æœ¬æ¬¡è®¿é—®
            initMap();
            updateMap();
            updateStats();
            syncCheckboxesWithVisited();
            updateVisitStats(); // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            // åˆæ¬¡æ¸²æŸ“ååˆ·æ–°ä¸€æ¬¡å°ºå¯¸ï¼Œé¿å… flex / æ¯”ä¾‹å¸ƒå±€å¯¼è‡´çš„ç¼©æ”¾é”™ä½
            setTimeout(refreshMapSize, 200);
            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ‰€æœ‰å·²å®Œæˆçš„ç¾¤å²›ï¼Œå¦‚æœå·²å®Œæˆä½†æœªæ˜¾ç¤ºè¿‡å¼¹çª—ï¼Œåˆ™æ˜¾ç¤º
            setTimeout(() => {
                checkAllGroupsCompletion();
            }, 1000);
        }

        // åˆå§‹åŒ–Leafletåœ°å›¾ï¼ˆåˆ›å»ºåœ°å›¾å®ä¾‹ã€æ·»åŠ å›¾å±‚ã€åˆ›å»ºæ ‡è®°ç­‰ï¼‰
        function initMap() {
            // æ ¹æ®æ‰€æœ‰å²›å±¿åæ ‡åŠ¨æ€è®¡ç®—è¾¹ç•Œï¼Œåªå›´ä½ç‰çƒå¼§é™„è¿‘ï¼Œé¿å…æ‹–åˆ°è¿œå¤„ç©ºæµ·åŸŸ
            const coords = Object.values(regions).map(r => [r.lat, r.lng]);
            const baseBounds = L.latLngBounds(coords);
            // ç•¥å¾®å¾€å››å‘¨æ‰©å±•ä¸€äº›æµ·åŸŸï¼Œpad å€¼å¯ä»¥æŒ‰éœ€è¦å¾®è°ƒ
            const paddedBounds = baseBounds.pad(0.4);
            
            // åˆ›å»ºåœ°å›¾ï¼Œåˆå§‹è§†è§’é€‚é…æ•´ä¸ªç‰çƒå¼§
            map = L.map('map', {
                center: paddedBounds.getCenter(),
                zoom: 7,
                minZoom: 6,  // æé«˜æœ€å°ç¼©æ”¾çº§åˆ«ï¼Œé˜²æ­¢ç¼©å°è¿‡å¤š
                maxZoom: 10, // é™åˆ¶æœ€å¤§ç¼©æ”¾ï¼Œé¿å…ç“¦ç‰‡è¾¹ç¼˜å’Œç°å—
                maxBounds: paddedBounds,
                maxBoundsViscosity: 1.0,
                zoomSnap: 0.25
            });

            // æ·»åŠ OpenStreetMapå›¾å±‚
            const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors',
                maxZoom: 19,
                keepBuffer: 6  // åŠ å¤§ç¼“å†²ï¼Œå°½é‡æå‰åŠ è½½å‘¨è¾¹ç“¦ç‰‡
            }).addTo(map);

            // æ ¹æ®è¾¹ç•Œè‡ªé€‚åº”ä¸€æ¬¡è§†é‡ï¼Œä¿è¯åˆå§‹èƒ½çœ‹åˆ°å®Œæ•´ç‰çƒå¼§
            // æ·»åŠ  padding ç¡®ä¿åœ°å›¾å†…å®¹ä¸å®¹å™¨æ¯”ä¾‹åŒ¹é…
            map.fitBounds(paddedBounds, {
                padding: [20, 20],
                maxZoom: 8  // é™åˆ¶ fitBounds çš„æœ€å¤§ç¼©æ”¾çº§åˆ«
            });

            // ç›‘å¬ç¼©æ”¾äº‹ä»¶ï¼Œç¡®ä¿ç¼©å°åä»ç„¶ä¿æŒåˆé€‚çš„è§†é‡å’Œæ¯”ä¾‹
            map.on('zoomend', function() {
                const currentZoom = map.getZoom();
                const currentBounds = map.getBounds();
                const mapSize = map.getSize();
                
                // å¦‚æœç¼©æ”¾çº§åˆ«å¤ªå°ï¼Œå¼ºåˆ¶è°ƒæ•´åˆ°åˆé€‚çš„è§†é‡
                if (currentZoom < 6.5) {
                    map.fitBounds(paddedBounds, {
                        padding: [20, 20],
                        maxZoom: 7.5
                    });
                }
                
                // æ£€æŸ¥åœ°å›¾è¾¹ç•Œæ˜¯å¦è¶…å‡ºé™åˆ¶èŒƒå›´
                if (!paddedBounds.contains(currentBounds)) {
                    // å¦‚æœè¶…å‡ºï¼Œé‡æ–°è°ƒæ•´åˆ°é™åˆ¶èŒƒå›´å†…
                    map.fitBounds(paddedBounds, {
                        padding: [20, 20],
                        maxZoom: currentZoom > 7.5 ? 7.5 : currentZoom
                    });
                }
            });
            
            // ç›‘å¬ç§»åŠ¨äº‹ä»¶ï¼Œç¡®ä¿åœ°å›¾ä¸ä¼šç§»å‡ºè¾¹ç•Œ
            map.on('moveend', function() {
                const currentBounds = map.getBounds();
                if (!paddedBounds.contains(currentBounds)) {
                    map.fitBounds(paddedBounds, {
                        padding: [20, 20]
                    });
                }
            });

            // é¢„åŠ è½½å½“å‰åŒºåŸŸåœ¨å¤šä¸ªç¼©æ”¾çº§åˆ«ä¸‹çš„ç“¦ç‰‡ï¼Œé¿å…åç»­æ‹–åŠ¨/æ”¾å¤§æ—¶å‡ºç°æœªåŠ è½½å—
            preloadTiles(paddedBounds, 5, 10);

            // åˆ›å»ºè‡ªå®šä¹‰å›¾æ ‡ï¼ˆå°½é‡ä¸é®ä½å°å²›ï¼Œç”¨ç»†è¾¹æ¡†åœ†åœˆè¡¨ç¤ºï¼‰
            const createRingIcon = (borderColor, fillColor, size = 16, borderWidth = 3) => {
                return L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="
                        width: ${size}px;
                        height: ${size}px;
                        background-color: ${fillColor};
                        border: ${borderWidth}px solid ${borderColor};
                        border-radius: 50%;
                        box-shadow: 0 1px 4px rgba(0,0,0,0.25);
                    "></div>`,
                    iconSize: [size, size],
                    iconAnchor: [size/2, size/2]
                });
            };

            // å·²è®¿é—®ï¼šç»†ç»¿è‰²åœ†ç¯ï¼Œä¸­å¿ƒåŸºæœ¬é€æ˜ï¼ˆæå‡ä¸ºå…¨å±€å˜é‡ï¼‰
            visitedIcon = createRingIcon('#2e7d32', 'rgba(102,187,106,0.15)', 16, 3);
            // æœªè®¿é—®ï¼šæ›´å°ã€æµ…ç»¿è‰²åœ†ç¯ï¼ˆæå‡ä¸ºå…¨å±€å˜é‡ï¼‰
            unvisitedIcon = createRingIcon('#81c784', 'rgba(200,230,201,0.1)', 12, 2);
            // æœºåœºï¼šå°æ©™è‰²å®å¿ƒç‚¹ï¼ˆæå‡ä¸ºå…¨å±€å˜é‡ï¼‰
            airportIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    width: 10px;
                    height: 10px;
                    background-color: #ff6f00;
                    border: 2px solid #ffe082;
                    border-radius: 50%;
                    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
                "></div>`,
                iconSize: [10, 10],
                iconAnchor: [5, 5]
            });

            // ä¸ºæ¯ä¸ªåŒºåŸŸåˆ›å»ºæ ‡è®°
            Object.entries(regions).forEach(([id, data]) => {
                const isVisited = visitedRegions.includes(id);
                const icon = isVisited ? visitedIcon : unvisitedIcon;
                
                // ä½¿ç”¨ç²¾ç¡®çš„åæ ‡åˆ›å»ºæ ‡è®°ï¼Œç¡®ä¿å®šä½å‡†ç¡®
                const marker = L.marker([data.lat, data.lng], { 
                    icon: icon,
                    draggable: false,
                    keyboard: true
                })
                    .addTo(map)
                    .bindPopup(`<div class="custom-popup">${data.name}<br>${isVisited ? 'âœ“ å·²è®¿é—®' : 'æœªè®¿é—®'}</div>`, {
                        className: 'custom-popup'
                    })
                    .bindTooltip(data.name, {
                        permanent: false,  // æ”¹ä¸ºæ‚¬åœæ˜¾ç¤ºï¼Œä¸æ°¸ä¹…æ˜¾ç¤º
                        direction: 'top',
                        className: 'island-label',
                        offset: [0, -10]  // æ ‡ç­¾æ˜¾ç¤ºåœ¨æ ‡è®°ä¸Šæ–¹
                    });

                marker.on('click', () => {
                    toggleRegion(id);
                });

                markers[id] = marker;
            });

            // æ·»åŠ æœºåœºæ ‡è®°
            airports.forEach(airport => {
                const marker = L.marker([airport.lat, airport.lng], { icon: airportIcon })
                    .addTo(map)
                    .bindPopup(`<div class="custom-popup">âœˆï¸ ${airport.name}</div>`, {
                        className: 'custom-popup'
                    });
                airportMarkers.push(marker);
            });
        }

        // å½“å®¹å™¨å°ºå¯¸å˜åŒ–æ—¶ï¼Œåˆ·æ–°åœ°å›¾å°ºå¯¸ï¼ˆè§£å†³flexå¸ƒå±€å¯¼è‡´çš„åœ°å›¾æ˜¾ç¤ºé—®é¢˜ï¼‰
        function refreshMapSize() {
            if (map) {
                map.invalidateSize();
            }
        }

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨åˆ·æ–°åœ°å›¾å°ºå¯¸
        window.addEventListener('resize', refreshMapSize);

        // é¢„åŠ è½½ç»™å®šè¾¹ç•Œå’Œç¼©æ”¾èŒƒå›´å†…çš„æ‰€æœ‰ç“¦ç‰‡ï¼ˆä¼šåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ï¼Œåç»­ä¸ä¼šé‡å¤è¯·æ±‚ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼‰
        function preloadTiles(bounds, minZoom, maxZoom) {
            const urlTemplate = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';
            const north = bounds.getNorth();
            const south = bounds.getSouth();
            const west = bounds.getWest();
            const east = bounds.getEast();

            const toRad = deg => deg * Math.PI / 180;

            function lon2tile(lon, z) {
                return Math.floor((lon + 180) / 360 * Math.pow(2, z));
            }

            function lat2tile(lat, z) {
                const n = Math.log(Math.tan(Math.PI / 4 + toRad(lat) / 2));
                return Math.floor((1 - n / Math.PI) / 2 * Math.pow(2, z));
            }

            for (let z = minZoom; z <= maxZoom; z++) {
                const xMin = lon2tile(west, z);
                const xMax = lon2tile(east, z);
                const yMin = lat2tile(north, z);
                const yMax = lat2tile(south, z);

                for (let x = xMin; x <= xMax; x++) {
                    for (let y = yMin; y <= yMax; y++) {
                        const url = urlTemplate
                            .replace('{z}', z)
                            .replace('{x}', x)
                            .replace('{y}', y);
                        const img = new Image();
                        img.src = url;
                    }
                }
            }
        }

        // æ›´æ–°åœ°å›¾æ˜¾ç¤ºï¼ˆæ ¹æ®å·²è®¿é—®çŠ¶æ€æ›´æ–°æ ‡è®°å›¾æ ‡å’Œå¼¹çª—å†…å®¹ï¼‰
        function updateMap() {
            if (!map) return;

            Object.entries(regions).forEach(([id, data]) => {
                if (markers[id]) {
                    const isVisited = visitedRegions.includes(id);
                    const newIcon = isVisited ? visitedIcon : unvisitedIcon;
                    markers[id].setIcon(newIcon);
                    markers[id].setPopupContent(`<div class="custom-popup">${data.name}<br>${isVisited ? 'âœ“ å·²è®¿é—®' : 'æœªè®¿é—®'}</div>`);
                }
            });
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆå·²è®¿é—®æ•°é‡ã€æ€»æ•°é‡ã€æ¢ç´¢è¿›åº¦ç™¾åˆ†æ¯”ï¼‰
        function updateStats() {
            const visitedCount = visitedRegions.length;
            const totalCount = Object.keys(regions).length;
            const totalArea = Object.values(regions).reduce((sum, r) => sum + r.area, 0);
            const visitedArea = visitedRegions.reduce((sum, id) => sum + (regions[id]?.area || 0), 0);
            const percentage = totalArea > 0 ? ((visitedArea / totalArea) * 100).toFixed(1) : 0;

            document.getElementById('visitedCount').textContent = visitedCount;
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('percentage').textContent = percentage + '%';
        }

        // åˆ—è¡¨å‹¾é€‰ä¸å·²è®¿é—®æ•°æ®åŒæ­¥ï¼ˆç¡®ä¿å¤é€‰æ¡†çŠ¶æ€ä¸å·²è®¿é—®æ•°æ®ä¸€è‡´ï¼‰
        function syncCheckboxesWithVisited() {
            document.querySelectorAll('.region-list .region-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (!checkbox) return;
                const id = checkbox.getAttribute('data-id');
                if (!id) return;
                const visited = visitedRegions.includes(id);
                checkbox.checked = visited;
                if (visited) {
                    item.classList.add('visited');
                } else {
                    item.classList.remove('visited');
                }
            });
        }

        /* ========== åŒºåŸŸè®¿é—®çŠ¶æ€ç®¡ç† ========== */
        // æ¸¸æˆåŒ–å¼¹çª—ç›¸å…³å‡½æ•°ï¼ˆæ˜¾ç¤ºåº†ç¥å¼¹çª—ï¼‰
        // type: 'first' é¦–æ¬¡è®¿é—®, 'group' å®ŒæˆæŸä¸ªç¾¤å²›
        // groupName: ç¾¤å²›åç§°ï¼ˆä»…åœ¨typeä¸º'group'æ—¶ä½¿ç”¨ï¼‰
        function showCelebrationModal(type, groupName = '') {
            const modal = document.getElementById('celebrationModal');
            const icon = document.getElementById('celebrationIcon');
            const title = document.getElementById('celebrationTitle');
            const text = document.getElementById('celebrationText');
            const pattern = document.getElementById('celebrationPattern');

            if (type === 'first') {
                // é¦–æ¬¡è®¿é—®æç¤º
                icon.textContent = 'ğŸŒº';
                title.textContent = 'æ­å–œä½ å¼€å§‹äº†å†²ç»³ä¹‹æ—…';
                text.textContent = 'å¼€å§‹ä½ çš„ç‰çƒåˆ—å²›æ¢ç´¢ä¹‹æ—…å§ï¼æ¯ä¸€åº§å²›å±¿éƒ½è—ç€ç‹¬ç‰¹çš„é£æ™¯å’Œæ•…äº‹ã€‚';
                pattern.innerHTML = '<span class="pattern-item">ğŸŒº</span><span class="pattern-item">ğŸï¸</span><span class="pattern-item">ğŸŒŠ</span><span class="pattern-item">ğŸ </span><span class="pattern-item">ğŸŒ´</span>';
            } else if (type === 'group') {
                // ç¾¤å²›å®Œæˆæç¤º
                icon.textContent = 'ğŸŠ';
                title.textContent = `${groupName}è¸éå®Œæˆï¼`;
                text.textContent = `å¤ªæ£’äº†ï¼ä½ å·²ç»æ¢ç´¢å®Œ${groupName}çš„æ‰€æœ‰å²›å±¿ï¼ç»§ç»­æ¢ç´¢å…¶ä»–ç¾¤å²›å§ï¼`;
                pattern.innerHTML = '<span class="pattern-item">ğŸ‰</span><span class="pattern-item">ğŸ†</span><span class="pattern-item">â­</span><span class="pattern-item">ğŸŒŸ</span><span class="pattern-item">âœ¨</span>';
            }

            modal.classList.add('show');
        }

        // å…³é—­åº†ç¥å¼¹çª—
        function closeCelebrationModal() {
            const modal = document.getElementById('celebrationModal');
            modal.classList.remove('show');
        }

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­ï¼ˆç›‘å¬ç‚¹å‡»äº‹ä»¶å’ŒESCé”®ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('celebrationModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeCelebrationModal();
                    }
                });
            }

            // ESCé”®å…³é—­å¼¹çª—
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeCelebrationModal();
                }
            });
        });

        // æ£€æŸ¥æŸä¸ªç¾¤å²›æ˜¯å¦å…¨éƒ¨å®Œæˆï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰
        function checkGroupCompletion(groupId) {
            // è·å–è¯¥ç¾¤å²›çš„æ‰€æœ‰å²›å±¿
            const groupIslands = Object.keys(regions).filter(id => regions[id].group === groupId);
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å²›å±¿éƒ½å·²è®¿é—®
            const allVisited = groupIslands.every(id => visitedRegions.includes(id));
            
            // è°ƒè¯•ä¿¡æ¯ï¼ˆå¯åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ï¼‰
            if (allVisited) {
                console.log(`âœ… ç¾¤å²› ${islandGroups[groupId]} å·²å®Œæˆï¼åŒ…å«çš„å²›å±¿ï¼š`, groupIslands);
                console.log('å·²è®¿é—®çš„å²›å±¿ï¼š', visitedRegions.filter(id => groupIslands.includes(id)));
            }
            
            return allVisited;
        }

        // æ£€æŸ¥æ˜¯å¦æ˜¯é¦–æ¬¡è®¿é—®ä»»ä½•å²›å±¿ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰
        function isFirstVisit() {
            return visitedRegions.length === 0;
        }

        // åˆ‡æ¢åŒºåŸŸè®¿é—®çŠ¶æ€ï¼ˆç‚¹å‡»åœ°å›¾æ ‡è®°æˆ–å¤é€‰æ¡†æ—¶è°ƒç”¨ï¼‰
        // id: åŒºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦
        function toggleRegion(id) {
            const wasFirstVisit = isFirstVisit();
            const regionData = regions[id];
            const wasInGroup = visitedRegions.includes(id);
            
            const index = visitedRegions.indexOf(id);
            if (index > -1) {
                visitedRegions.splice(index, 1);
            } else {
                visitedRegions.push(id);
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯é¦–æ¬¡è®¿é—®ï¼ˆä»0ä¸ªå˜ä¸º1ä¸ªï¼‰
                if (wasFirstVisit && visitedRegions.length === 1) {
                    setTimeout(() => {
                        showCelebrationModal('first');
                    }, 300);
                }
            }
            
            saveData();
            updateMap();
            updateStats();
            syncCheckboxesWithVisited();
            
            // æ£€æŸ¥ç¾¤å²›å®Œæˆæƒ…å†µï¼ˆåªæœ‰åœ¨æ ‡è®°ä¸ºå·²è®¿é—®æ—¶æ‰æ£€æŸ¥ï¼‰
            if (!wasInGroup && visitedRegions.includes(id)) {
                const groupId = regionData.group;
                const groupName = islandGroups[groupId];
                
                // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿æ•°æ®å·²æ›´æ–°
                setTimeout(() => {
                    if (checkGroupCompletion(groupId)) {
                        // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡è¿™ä¸ªç¾¤å²›çš„å®Œæˆæç¤º
                        const completedGroups = JSON.parse(localStorage.getItem('completedGroups') || '[]');
                        if (!completedGroups.includes(groupId)) {
                            console.log(`ğŸ‰ æ˜¾ç¤ºå®Œæˆå¼¹çª—ï¼š${groupName}`);
                            showCelebrationModal('group', groupName);
                            completedGroups.push(groupId);
                            localStorage.setItem('completedGroups', JSON.stringify(completedGroups));
                        } else {
                            console.log(`â„¹ï¸ ${groupName} å·²å®Œæˆï¼Œä½†ä¹‹å‰å·²ç»æ˜¾ç¤ºè¿‡å¼¹çª—äº†`);
                        }
                    }
                }, 500);
            }
        }

        // ä¾›å¤é€‰æ¡†è°ƒç”¨çš„åŒ…è£…å‡½æ•°ï¼ˆä»å¤é€‰æ¡†å…ƒç´ è·å–åŒºåŸŸIDå¹¶åˆ‡æ¢çŠ¶æ€ï¼‰
        function toggleRegionFromCheckbox(checkbox) {
            const id = checkbox.getAttribute('data-id');
            if (!id) return;
            toggleRegion(id);
        }

        // æ‰‹åŠ¨æ£€æŸ¥æ‰€æœ‰ç¾¤å²›çš„å®ŒæˆçŠ¶æ€ï¼ˆç”¨äºè°ƒè¯•å’Œæµ‹è¯•ï¼‰
        function checkAllGroupsCompletion() {
            console.log('ğŸ” æ£€æŸ¥æ‰€æœ‰ç¾¤å²›çš„å®ŒæˆçŠ¶æ€...');
            Object.keys(islandGroups).forEach(groupId => {
                const groupName = islandGroups[groupId];
                const isCompleted = checkGroupCompletion(groupId);
                const completedGroups = JSON.parse(localStorage.getItem('completedGroups') || '[]');
                const hasShown = completedGroups.includes(groupId);
                
                console.log(`${isCompleted ? 'âœ…' : 'âŒ'} ${groupName}: ${isCompleted ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'} ${hasShown ? '(å·²æ˜¾ç¤ºè¿‡å¼¹çª—)' : '(æœªæ˜¾ç¤ºè¿‡å¼¹çª—)'}`);
                
                // å¦‚æœå·²å®Œæˆä½†æœªæ˜¾ç¤ºè¿‡å¼¹çª—ï¼Œç°åœ¨æ˜¾ç¤º
                if (isCompleted && !hasShown) {
                    console.log(`ğŸ‰ ä¸º ${groupName} æ˜¾ç¤ºå®Œæˆå¼¹çª—`);
                    showCelebrationModal('group', groupName);
                    completedGroups.push(groupId);
                    localStorage.setItem('completedGroups', JSON.stringify(completedGroups));
                }
            });
        }


        // æ¸…é™¤æ‰€æœ‰è®°å½•ï¼ˆéœ€è¦ç”¨æˆ·ç¡®è®¤ï¼Œæ¸…ç©ºå·²è®¿é—®åˆ—è¡¨å’Œå®Œæˆç¾¤å²›è®°å½•ï¼‰
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è®¿é—®è®°å½•å—ï¼Ÿ')) {
                visitedRegions = [];
                localStorage.removeItem('completedGroups');
                saveData();
                updateMap();
                updateStats();
                syncCheckboxesWithVisited();
            }
        }

        // éšæœºé€‰æ‹©ç›®çš„åœ°ï¼ˆä»æœªè®¿é—®çš„å²›å±¿ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªï¼Œå¹¶åœ¨åœ°å›¾ä¸Šé«˜äº®æ˜¾ç¤ºï¼‰
        function randomDestination() {
            const unvisited = Object.keys(regions).filter(id => !visitedRegions.includes(id));
            if (unvisited.length === 0) {
                alert('ğŸ‰ æ­å–œï¼ä½ å·²ç»è®¿é—®äº†æ‰€æœ‰åœ°ç‚¹ï¼');
                return;
            }
            const randomId = unvisited[Math.floor(Math.random() * unvisited.length)];
            const region = regions[randomId];
            
            const resultDiv = document.getElementById('randomResult');
            document.getElementById('randomDestinationName').textContent = region.name;
            resultDiv.classList.add('show');
            
            // é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„åŒºåŸŸå¹¶ç§»åŠ¨åˆ°åœ°å›¾ä¸­å¿ƒå¹¶æ”¾å¤§
            const marker = markers[randomId];
            if (marker && map) {
                const targetLatLng = [regions[randomId].lat, regions[randomId].lng];
                const targetZoom = Math.min(map.getMaxZoom ? (map.getMaxZoom() || 10) : 10, 10);

                // ä½¿ç”¨å¹³æ»‘é£è¡ŒåŠ¨ç”»å°†åœ°å›¾å±…ä¸­åˆ°ç›®æ ‡å²›å±¿å¹¶æ”¾å¤§
                map.flyTo(targetLatLng, targetZoom, {
                    animate: true,
                    duration: 1.2,
                    easeLinearity: 0.25
                });

                // åœ¨é£è¡Œç»“æŸåæ‰“å¼€å¼¹çª—ï¼Œé¿å…è¢«åŠ¨ç”»æ‰“æ–­
                map.once('moveend', () => {
                    marker.openPopup();
                });
                // æ·»åŠ é—ªçƒæ•ˆæœ
                let flashCount = 0;
                const flashInterval = setInterval(() => {
                    if (flashCount++ >= 6) {
                        clearInterval(flashInterval);
                        return;
                    }
                    const currentIcon = marker.options.icon;
                    const newIcon = flashCount % 2 === 0 
                        ? L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="
                                width: 30px;
                                height: 30px;
                                background-color: #ffb74d;
                                border: 4px solid #ff9800;
                                border-radius: 50%;
                                box-shadow: 0 0 15px rgba(255,183,77,0.8);
                            "></div>`,
                            iconSize: [30, 30],
                            iconAnchor: [15, 15]
                        })
                        : currentIcon;
                    marker.setIcon(newIcon);
                }, 300);
            }
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆå°†å·²è®¿é—®åŒºåŸŸåˆ—è¡¨ä¿å­˜åˆ°localStorageï¼‰
        function saveData() {
            localStorage.setItem('visitedRegions', JSON.stringify(visitedRegions));
        }

        // åˆ†äº«é¡µé¢ï¼ˆä½¿ç”¨Web Share APIæˆ–é™çº§åˆ°å¤åˆ¶é“¾æ¥ï¼‰
        function sharePage() {
            if (navigator.share) {
                navigator.share({
                    title: 'æˆ‘çš„å†²ç»³æ—…æ¸¸è®°å½•',
                    text: `æˆ‘å·²ç»è®¿é—®äº† ${visitedRegions.length} ä¸ªåœ°ç‚¹ï¼Œæ¢ç´¢è¿›åº¦ ${document.getElementById('percentage').textContent}ï¼`,
                    url: window.location.href
                }).catch(err => console.log('åˆ†äº«å¤±è´¥', err));
            } else {
                copyLink();
            }
        }

        // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿ï¼ˆä½¿ç”¨Clipboard APIæˆ–é™çº§æ–¹æ¡ˆï¼‰
        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                // é™çº§æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = url;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        // å¯¼å‡ºæ•°æ®ï¼ˆå°†å·²è®¿é—®åŒºåŸŸåˆ—è¡¨å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼‰
        function exportData() {
            const data = {
                visitedRegions: visitedRegions,
                exportDate: new Date().toISOString(),
                stats: {
                    visitedCount: visitedRegions.length,
                    totalCount: Object.keys(regions).length,
                    percentage: document.getElementById('percentage').textContent
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å†²ç»³æ—…æ¸¸è®°å½•_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¯¼å…¥æ•°æ®ï¼ˆè§¦å‘æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼‰
        function importData() {
            document.getElementById('importFile').click();
        }

        // å¤„ç†å¯¼å…¥ï¼ˆè¯»å–JSONæ–‡ä»¶å¹¶æ›´æ–°å·²è®¿é—®åŒºåŸŸåˆ—è¡¨ï¼‰
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.visitedRegions && Array.isArray(data.visitedRegions)) {
                        visitedRegions = data.visitedRegions;
                        saveData();
                        updateMap();
                        updateStats();
                        syncCheckboxesWithVisited();
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } else {
                        alert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼');
                    }
                } catch (err) {
                    alert('å¯¼å…¥å¤±è´¥ï¼š' + err.message);
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥
        }

        /* ========== é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ– ========== */
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åˆå§‹åŒ–
        init();

        // åœ¨æµè§ˆå™¨æ§åˆ¶å°å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè°ƒè¯•ï¼š
        // checkAllGroupsCompletion() - æ£€æŸ¥æ‰€æœ‰ç¾¤å²›çš„å®ŒæˆçŠ¶æ€å¹¶æ˜¾ç¤ºæœªæ˜¾ç¤ºè¿‡çš„å¼¹çª—
        // å¦‚æœéœ€è¦é‡æ–°æ˜¾ç¤ºæŸä¸ªç¾¤å²›çš„å®Œæˆå¼¹çª—ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
        // localStorage.removeItem('completedGroups'); location.reload();
    </script>
</body>
</html>
